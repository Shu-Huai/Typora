# 软件形式化方法（2）

## 关系和函数

### 关系

**若干个集合的元素之间的关系**

#### 关系表示法

只讨论**二元关系**

关系是一个序偶的集合

如果 $X$ 和 $Y$ 是集合，那么它们的笛卡儿积 $X\times Y$ 也是一个集合。

$X$ 和 $Y$ 的一个关系 $R$ 是笛卡儿积 $X\times Y$ 的子集，也就是说，$R\subseteq X\times Y$

$X$ 到 $Y$ 的所有关系的类型被写成 $X\leftrightarrow Y$，也就是 $\mathbb P(X\times Y)$

**定义**：$X\leftrightarrow Y==\mathbb P(X\times Y)$

$(x,y)$ 可以写成 $x\mapsto y$，读作 $x$ 映射到 $y$

如果一个关系所关联的两个元素取自千同一集合 $X$，则说这是集合 $X$ 上的关系

#### 定义域和值域

源集和目标集

关系的定义域是关系源集的一个子集，该子集中的任一元素至少与目标集中的一个元素有给定的关系。

关系的值域是关系目标集的一个子集，对于该子集中的任一元素，在源集中都有元素与其有给定的关系。

如果 $R$ 是一个类型为 $X\leftrightarrow Y$ 的关系，通常可以 $\text{dom} R$ 来表示 $R$ 的定义域，以 $\text{ran} R$ 来表示 $R$ 的值域。

**性质**：

1. $x\in\operatorname{dom}R\Leftrightarrow(\exists y: Y \cdot x R y)$
2. $y\in \text{ran} R \Leftrightarrow (\exists x: X \cdot x R y)$
3. $\text{dom}\lbrace x_{1}\mapsto y_{1},\cdots, x_{n}\mapsto y_{n}\rbrace=\lbrace x_{1},\cdots, x_{n}\rbrace$
4. $\operatorname{ran}\lbrace x_{1}\mapsto y_{1},\cdots, x_{n}\mapsto y_{n}\rbrace=\lbrace y_{1},\cdots, y_{n}\rbrace$
5. $\operatorname{dom}(Q\cup R)=(\operatorname{dom} Q)\cup(\operatorname{dom} R)$
6. $\operatorname{ran}(Q\cup R)=(\operatorname{ran} Q)\cup(\operatorname{ran} R)$
7. $\operatorname{dom}(Q\cap R)\subseteq (\operatorname{dom} Q)\cap(\operatorname{dom} R)\operatorname{ran}(Q\cap R)\subseteq(\operatorname{ran} Q)\cap(\operatorname{ran} R)$
8. $\text{dom}\varnothing=\varnothing$
9. $\operatorname{ran}\varnothing=\varnothing$

### 关系的运算

关系本身就是序偶的集合，所以对于集合的运算都可应用于关系。

#### 关系复合

给定两个关系，如果第一个关系的值域类型与第二个关系的定义域类型相同，则可由这两个关系通过关系复合得到一个新的关系。新关系的定义域与第一个关系的定义域相同，其值域的类型与第二个关系的值域类型相同。

**类似复合函数**

使用运算符<img src="http://public.file.lvshuhuai.cn/images\image-20241203172656121.png" alt="image-20241203172656121" style="zoom:50%;" />

设 $R$ 和 $S$ 是两个已经定义的关系：$R:X\leftrightarrow Y;S:Y\leftrightarrow Z$

则它们的复合 $R$<img src="http://public.file.lvshuhuai.cn/images\image-20241203172656121.png" alt="image-20241203172656121" style="zoom:50%;" />$S$ 可以用下述的集合来定义：

$\lbrace x:X;z:Z|(\exists y:Y\cdot (xRy\land ySz))\cdot x\mapsto z\rbrace$

#### 恒等和闭包

$R:X\leftrightarrow Y$ 是一个关系

**异类关系**：如果 $X$ 与 $Y$ 是不同的类型，则 $R$ 是一个异类关系

**同类关系**：如果 $X$ 与 $Y$ 是同一个类型

类型 $X$ 的两个元素之间最简单的同类关系是恒等关系，记为 $\textbf{id}X$

恒等关系：$\textbf{id}X==\lbrace x:X\cdot x\mapsto x\rbrace$

整数集 $\mathbb Z$ 上的”等于”是恒等关系中的一个典型例子。

一个**同类关系** $R$ 的传递**闭包**是一个关系，它由除了 $R^0$ 以外的所有 $R$ 的关系复合的并集构成，记为 $R^+$
$$
R^+=\bigcup_{i=1}^{\infty}{R^i}=R^1\cup R^2\cup R^3\cup R^4\cup\cdots
$$
关系 $R$ 的一个**自反传递闭包**（Reflective-Transitive Closure）是一个关系，它由包括 $R^0$ 在内的所有 $R$ 关系复合的并集构成，记为 $R^{\ast}$
$$
R^{\ast}=\bigcup_{i=0}^{\infty}{R^i}=R^0\cup R^1\cup R^2\cup R^3\cup\cdots
$$
**一些定律**
$$
P \bowtie (Q \bowtie R) = (P \bowtie Q) \bowtie R
$$

$$
(x \mapsto x') \in \text{id } X \iff x = x' \in X
$$

$$
(x \mapsto z) \in P \bowtie Q \iff (\exists y: Y \cdot x \, P \, y \land y \, Q \, z)
$$

$$
\text{id } X \bowtie P = P
$$

$$
P \bowtie \text{id } Y = P
$$

$$
\text{id } V \bowtie \text{id } W = \text{id } (V \cap W)
$$

$$
R \subseteq R^+
$$

$$
R^+ \bowtie R^+ \subseteq R^+
$$

$$
R \subseteq Q \land Q \bowtie Q \subseteq Q \implies R^+ \subseteq Q
$$

$$
\text{id } X \subseteq R^\ast
$$

$$
R \subseteq R^*
$$

$$
\text{id } X \subseteq Q \land R \subseteq Q \land Q \bowtie Q \subseteq Q \implies R^\ast \subseteq Q
$$

$$
R^* = R^+ \cup \text{id } X = (R \cup \text{id } X)^+
$$

$$
(R^+)^+ = R^+
$$

$$
(R^\ast)^\ast = R^\ast
$$

#### 关系的逆

一个关系的逆以上标“$\sim$”来表示

关系和它的逆关系是互逆的

对任何类型为 $X\leftrightarrow Y$ 的关系 $R$，它的逆关系为：$R^\sim==\lbrace x:X;y:Y|x\mapsto y\in R\cdot y\mapsto x\rbrace$

若 $R$ 是集合 $X$ 到集合 $Y$ 的一个关系，则其逆关系 $R$ 是 $Y$ 到 $X$ 的关系。如果 $Y$ 是一个与 $X$ 相同的集合，则 $R$ 和 $R^\sim$ 都是 $X$ 上的关系

为了与关系自身复合运算的记号一致，也可定义 $R^{-1}$ 为关系的逆，$R^{-1}=R^{\sim}$

定律

$$( y \mapsto x ) \in R^{\sim} \Leftrightarrow ( x \mapsto y ) \in R$$

$$( Q \bowtie R )^{\sim} = R^{\sim} ; Q^{\sim}$$

$$\mathrm{dom} ( R^{\sim} ) = \mathrm{ran} R$$

$$\mathrm{id} ( \mathrm{dom} R ) \subseteq R ; R^{\sim}$$

$$(R^\sim)^\sim=R$$

$$(\mathrm{id}V)^\sim=\mathrm{id}V$$

$$\mathrm{ran} ( R^{\sim} ) = \mathrm{dom} R$$

$$\mathrm{id} ( \mathrm{ran} R ) \subseteq R^{\sim} ; R$$

有了关系逆的运算，又有下述关于关系的复合运算的定律：

$$R^{0} = \mathrm{id} X $$

$$R^{1} = R$$

$$R^{2} = R \circ R$$

$$R^{-1} = R^{\sim}$$

$$k \geq 0 \Rightarrow R^{k + 1} = R \circ R^{k} = R^{k} \circ R$$

$$R^{a + b} = R^{a} \circ R^{b}$$

$$R^{a \cdot b} = ( R^{a} )^{b}$$

$$( R^{\sim} )^{a} = ( R^{a} )^{\sim}$$

$$R^1=R$$

$$R^{-1}=R^\sim$$

$$(R^\sim)^a=(R^a)^\sim$$