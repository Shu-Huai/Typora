# 软件形式化方法（3）

## 模式和规格说明

### 模式的描述功能

#### 模式描述抽象状态

模式的一个重要功能就是描述系统的抽象数据类型的状态。

描述目标软件系统某一部分数据类型的结构特征的模式，称为状态模式。

状态模式定义了目标软件系统某一部分的状态空间及其约束特性，系统中该部分的状态存在于状态空间之中。

<img src="http://public.file.lvshuhuai.cn/images\image-20241206212453200.png" alt="image-20241206212453200" style="zoom:50%;" />

模式的声明部分与谓词部分一起描述了数据空间

#### 模式描述操作

操作模式描述了系统某部分的行为特征，它通过描述操作前该部分的状态值和操作后该部分状态值之间的关系，来定义系统该部分的一种操作特性。

<img src="http://public.file.lvshuhuai.cn/images\image-20241206212818244.png" alt="image-20241206212818244" style="zoom:50%;" />

在操作模式中，未带修饰符的元素及其谓词描述的是操作前系统该部分的状态，带有修饰符 $'$ 的元素及其谓词描述的是操作后系统该部分的状态

输入变量的最后一个字符后跟随一个 $?$， 输出变量的最后一个字符后跟随一个 $!$​。

### 模式的修饰和包含

#### 模式的修饰

可在一个模式名的后面添加上撇号来对模式进行修饰

模式修饰的作用是将修饰应用到被修饰模式的声明部分中所有的变量

修饰的状态模式在 Z 中被称为后状态模式

例子：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208204014137.png" alt="image-20241208204014137" style="zoom:50%;" />

#### 模式包含

**目的**：为了使规格说明的长度缩短

一个模式将另一个模式的名包含在其声明中

设模式 $T$ 将模式名 $S$ 包含在声明中，则称 $T$ 包含 $S$。其作用是，$S$ 的声明成了 $T$ 声明的一部分，而 $S$ 的谓词被添加在 $T$ 的谓词部分并构成一个或多个合取式

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208204042987.png" alt="image-20241208204042987" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208204050599.png" alt="image-20241208204050599" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208204058645.png" alt="image-20241208204058645" style="zoom:50%;" />

#### $\Delta$ 和 $\Xi$ 表示

对于状态模式 $S$，$\Delta S$ 是一个模式，由前状态模式 $S$ 和后状态模式 $S'$ 组合得到。$\Delta S=S\land S'$

<img src="http://public.file.lvshuhuai.cn/images\image-20241208204806267.png" alt="image-20241208204806267" style="zoom:50%;" />

$\Delta S$ 中含有 $S$ 的所有声明和谓词，再加上 $S'$ 中变量的声明和相关的谓词，$S'$ 中的变量是 $S$ 中声明变量的修饰变量

对于状态模式 $S$，$\Delta S$​ 仍然是一个模式，而不是一个操作。

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208205800368.png" alt="image-20241208205800368" style="zoom:50%;" />

$\Xi S$ 是 $\Delta S$ 的一个扩充

<img src="http://public.file.lvshuhuai.cn/images\image-20241208205512737.png" alt="image-20241208205512737" style="zoom:50%;" />

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208205735538.png" alt="image-20241208205735538" style="zoom:50%;" />

#### 初始状态模式

系统的初始状态是系统建立时的状态

可以把一个系统的初始化看成一个特定的运算：它建立了一个新的状态模式，但它不是对其他任何状态进行运算所建立的。它没有前状态，只有一个带有撇号修饰的变量的后状态。

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208210341285.png" alt="image-20241208210341285" style="zoom:50%;" />

### 模式运算

#### 命题连接词连接模式

对任意两个模式 $S$ 和 $T$​，以命题连接词连接的结果是一个新的模式。

$S$ 和 $T$ 的声明部分合并构成了新模式的声明部分，$S$ 的谓词部分和 $T$ 的谓词部分以给定的命题连接词连接构成新的模式的谓词部分

$S\land T$、$S\lor T$、$S\Rightarrow T$、$S\Leftrightarrow T$、$\neg S$

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208211623048.png" alt="image-20241208211623048" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208211643292.png" alt="image-20241208211643292" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208211650792.png" alt="image-20241208211650792" style="zoom:50%;" />

#### 模式复合

$A=B\circ C$，模式 $A$ 定义为模式 $B$ 和模式 $C$ 的复合

如果模式 $B$ 引起变量 $S_1$ 改变为 $S_2$，而模式 $C$ 引起变量 $S_2$ 改变为 $S_3$，则模式 $A$ 就会产生变量 $S_1$ 到 $S_3$ 的改变。

**模式成分换名**和**模式成分隐蔽**

模式成分换名就是对模式中的变量换名，表达式 $Q[m/x]$ 表示了模式 $Q$ 中的变量 $x$ 的所有自由出现（ 不是某一个量词变量）都替换为 $m$​。

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208213115900.png" alt="image-20241208213115900" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208213125312.png" alt="image-20241208213125312" style="zoom:50%;" />

$\backslash$ 是隐蔽操作符号，$Q\backslash (x)$ 是模式成分隐蔽

**作用**：从模式的声明部分中删除隐蔽变量表中列出的变最的声明，但在模式的谓词部分将它们用存在量词进行量词化

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208213132963.png" alt="image-20241208213132963" style="zoom:50%;" />

模式复合是一种关联一个模式的后状态变量和另一个模式的前状态变量的方法，所关联的变量必须具有相同的基本名。

一个变量的**基本名**就是删除了修饰的变量名。

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241208213510034.png" alt="image-20241208213510034" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208213520289.png" alt="image-20241208213520289" style="zoom:50%;" />

**模式复合的操作**：

1. 检查在两个模式中修饰变量及其非修饰变量的集合是否相同，如果不同，则模式的复合是无定义的。本例中该集合为 $\lbrace s',s\rbrace$，在 $R$ 中和 $W$ 中是相同的。
2. 检查两个模式的声明部分中任何输入和输出变量的类型是否冲突，若冲突，则这两个模式的复合无定义。在本例中，$x?$ 在模式 $R$ 和 $W$ 中的类型均为 $\mathbb N$。
3. 将模式复合操作中的前一模式中的后状态变量换名为一个新的变量。对本例可将 $R$ 中的 $s'$ 换名为 $s^+$，即有 $R[s^+/s']$​ 。
4. 将模式复合操作中的后一模式中的前状态变量换名为步骤 3 中给出的新变量。在本例中，该新变量就是$s^+$，这样就构成了 $W[s^+/s]$。
5. 构成由步骤 3 和 4 所获得的换了名的模式的合取。对于本例，即有 $R[s^+/s']\land W[s^+/s]$。
6. 隐蔽由步骤 3 和 4 所引入的已在由步骤 5 所获得的新模式中的变量。对本例，就可有模式 $(R[s^+/s']\land W[s^+/s])\backslash (s^+)$

<img src="http://public.file.lvshuhuai.cn/images\image-20241208214227767.png" alt="image-20241208214227767" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208214235094.png" alt="image-20241208214235094" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208214242729.png" alt="image-20241208214242729" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241208214314535.png" alt="image-20241208214314535" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241209204938291.png" alt="image-20241209204938291" style="zoom:50%;" />

#### 一个关于模式复合的例子

<img src="http://public.file.lvshuhuai.cn/images\image-20241209210154728.png" alt="image-20241209210154728" style="zoom:50%;" />

#### 前置条件模式

对一个描述了某操作的模式，其前置条件就是这样一个精确的条件：在该条件下，给定的操作是可应用的。

前置条件运算符记作 $Pre$​。

只能应用于描述操作的模式，运算的结果为一个模式，称为前置条件模式。

对给定的模式，从它的声明部分中删除输出变量和后状态变量，并在谓词部分将它们用存在量词进行约束

**例子**：

<img src="http://public.file.lvshuhuai.cn/images\image-20241209211004189.png" alt="image-20241209211004189" style="zoom:50%;" />

### 模式类型和通用模式

#### 模式类型

一个模式类型是若干个变量名和类型的结合

对于两个模式，如果在它们的声明部分中，仅是变量与类型结合的次序不同，则这两个模式类型就被看成是相同的

谓词部分对建立模式的类型不起作用

#### 在声明中使用模式类型

**例子**：

<img src="Z:\Public\images\image-20241212114418797.png" alt="image-20241212114418797" style="zoom:50%;" />

#### 通用式模式定义

**一般形式**：

<img src="Z:\Public\images\image-20241212123115200.png" alt="image-20241212123115200" style="zoom:50%;" />

其中 $x_i$ 是通用式形式参数，它可以作为类型或集合在 $D$ 中声明变量时使用，$D$ 和 $P$ 与一般的模式定义一样，分别为声明部分和谓词部分。当要使用一个通用式模式时，必须给通用式形式参数以具体值。

例子：

<img src="Z:\Public\images\image-20241212123647139.png" alt="image-20241212123647139" style="zoom:50%;" />

<img src="Z:\Public\images\image-20241212123709251.png" alt="image-20241212123709251" style="zoom:50%;" />

<img src="Z:\Public\images\image-20241212123700185.png" alt="image-20241212123700185" style="zoom:50%;" />

### 规格说明文档的结构

规格说明书写者的责任之一就是合理组织规格说明，以使得简单的事情简明地说明。另一个重要方面就是如何安排和使用非形式的正文。

在整个规格说明文档中非形式的正文是伴随着形式规格说明出现的。

非形式的正文是以自然语言、图、表等表示工具描述的正文。
