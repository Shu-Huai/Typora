# 3D 高斯溅射

## 概述

**Gaussian Splatting** 是一种新兴的 3D 渲染和建模技术，主要用于基于图像的场景重建。它在计算机视觉和计算图形领域引起了广泛关注，特别是在高效渲染复杂场景的任务中。

### 核心概念

1. **高斯分布表示空间点**：
   - Gaussian Splatting 使用 3D 空间中的高斯分布（即高斯点）来表示场景中的元素。每个高斯点定义了一个 3D 坐标位置、颜色信息、方向信息，以及其在空间中的不确定性（即分布的大小和形状）。
2. **稀疏表示**：
   - 通过使用高斯点来表示场景，Gaussian Splatting 可以稀疏表示复杂的几何结构和纹理信息。这种方法比传统的体素或点云表示更加紧凑且计算效率更高。
3. **渲染方式**：
   - 在渲染过程中，视图方向和每个高斯点的分布相结合，通过计算高斯点的投影和混合效果生成最终的图像。它有效利用了 GPU 的并行计算能力。

## 核心原理

### 高斯点表示场景

在 3D 场景中，场景的元素（如物体表面、纹理等）用 **高斯点（Gaussian Points）** 来表示。这些高斯点是具有以下特性的 3D 分布：

- **位置（Position）**：高斯点的中心表示其在 3D 空间中的位置 $(x, y, z)$。
- **形状（Shape）**：通过协方差矩阵描述高斯分布的形状、大小和方向。
- **颜色和透明度（Color and Opacity）**：每个高斯点带有颜色属性（RGB 值）和透明度，用于渲染时的混合计算。
- **密度（Density）**：控制该高斯点对最终图像的贡献。

高斯分布的数学形式为：
$$
G(x, \mu, \Sigma) = \exp\left(-\frac{1}{2}(x - \mu)^T \Sigma^{-1} (x - \mu)\right)
$$
其中：

- $\mu$ 是高斯点的位置；
- $\Sigma$ 是协方差矩阵，描述高斯点的形状和方向。

#### 一维高斯分布

一维高斯分布描述的是一维随机变量 $x$ 的分布情况，其数学表达式为：
$$
f(x; \mu, \sigma^2) = \frac{1}{\sqrt{2\pi\sigma^2}} \exp\left(-\frac{(x - \mu)^2}{2\sigma^2}\right)
$$
**各符号的含义**：

- $x$：随机变量，表示需要求概率密度的点。
- $\mu$：均值（Mean），表示分布的中心位置，分布的最高点位于 $\mu$。
- $\sigma^2$：方差（Variance），控制分布的宽度。标准差是 $\sigma = \sqrt{\sigma^2}$。
- $\sqrt{2\pi\sigma^2}$：归一化因子，确保分布的概率密度总和为 1。
- $⁡\exp$：自然指数函数，表示高斯分布的衰减特性。

**解释**：

- **形状**：高斯分布是一种钟形曲线，均值 $\mu$ 决定分布的中心，方差 $\sigma^2$ 决定分布的宽度。
- **归一化**：积分 $\int_{-\infty}^\infty f(x; \mu, \sigma^2) dx = 1$，表示分布覆盖所有可能取值的概率总和为 1。

#### 多维高斯分布

高斯分布可以扩展到多维空间，描述一个多维随机变量 $\mathbf{x} = [x_1, x_2, \dots, x_d]^T$ 的分布。其数学表达式为：
$$
f(\mathbf x; \mathbf{\mu}, \mathbf{\Sigma}) = \frac{1}{(2\pi)^{\frac{d}{2}} |\mathbf{\Sigma}|^{\frac{1}{2}}} \exp\left(-\frac{1}{2} (\mathbf x - \mathbf{\mu})^T \mathbf{\Sigma}^{-1} (\mathbf{x} - \mathbf{\mu}) \right)
$$


**各符号的含义**：

- $\mathbf{x}$：$d$-维随机变量。
- $\mathbf{\mu}$：$d$-维均值向量，表示分布的中心位置。
- $\mathbf{\Sigma}$：$d \times d$ 协方差矩阵（Covariance Matrix），描述变量之间的关系和分布的形状。
  - 对角线元素：表示每个变量的方差，决定沿每个坐标轴的分布宽度。
  - 非对角线元素：表示变量之间的协方差，决定分布的方向性和椭圆形状。
- $|\mathbf{\Sigma}|$：协方差矩阵的行列式，表示分布的规模。
- $(\mathbf{x} - \mathbf{\mu})^T \mathbf{\Sigma}^{-1} (\mathbf{x} - \mathbf{\mu})$：马氏距离（Mahalanobis Distance），表示点 $\mathbf{x}$ 与中心 $\mathbf{\mu}$ 的加权距离。

**解释**：

- **形状**：多维高斯分布在空间中通常表现为椭球形，其形状由协方差矩阵 $\mathbf{\Sigma}$ 决定。
- **独立性**：如果协方差矩阵为对角矩阵，则变量是独立的；否则变量之间存在相关性。
- **归一化**：分布的概率密度在整个空间中的积分为 1。

#### 随机变量

在高斯分布中，一维随机变量 $x$ 是一个 **数值变量**，用于表示一个随机事件的结果或观测值。它在数学上是一个变量，满足某种概率分布（如高斯分布）。

**随机变量的定义**

随机变量是一个数值化的变量，其值由随机实验的结果决定。例如：

- 投掷一枚硬币的结果（记作 0 和 1）是一个随机变量。
- 测量某个物理量（如温度、长度）时，测量值是一个随机变量。

对于一维随机变量 $x$，它的值是实数，通常用来描述单一的、连续变化的量。

**随机变量的意义**

1. **概率意义**：
   - 对于 $x$ 的某个具体值 $x_0$，高斯分布 $f(x_0; \mu, \sigma^2)$ 表示随机变量取值 $x_0$ 的概率密度。
   - 例如，在温度的例子中，$f(18)$ 表示气温是 18°C 的可能性有多大。
2. **分布意义**：
   - $x$ 的分布是连续的，它表示随机变量 $x$ 在整个实数范围内的分布规律。

#### 协方差

**协方差矩阵（Covariance Matrix）** 是一个数学工具，用于描述多维随机变量中各维度之间的相关性和每个维度的方差。它在概率与统计、机器学习和数据分析中广泛使用。

**协方差的概念**

协方差（Covariance）是两个随机变量之间关系的度量，用于描述它们如何一起变化。对于随机变量 $X$ 和 $Y$，其协方差定义为：
$$
\text{Cov}(X, Y) = \mathbb{E}[(X - \mathbb{E}[X])(Y - \mathbb{E}[Y])]
$$

其中：

- $\mathbb{E}[X]$ 和 $\mathbb{E}[Y]$：分别是 $X$ 和 $Y$ 的期望值。
- $(X - \mathbb{E}[X])$ 和 $(Y - \mathbb{E}[Y])$：分别是 $X$ 和 $Y$ 的偏离均值的差。

**协方差的意义**

- 如果 $\text{Cov}(X, Y) > 0$：当 $X$ 增大时，$Y$ 也倾向于增大，表示正相关。
- 如果 $\text{Cov}(X, Y) < 0$：当 $X$ 增大时，$Y$ 倾向于减小，表示负相关。
- 如果 $\text{Cov}(X, Y) = 0$：$X$ 和 $Y$ 没有线性相关性。

**协方差矩阵的定义**

对于一个 $d$-维随机向量 $\mathbf{X} = [X_1, X_2, \dots, X_d]^T$，协方差矩阵 $\boldsymbol{\Sigma}$ 是一个 $d \times d$ 的矩阵，定义为：
$$
\boldsymbol{\Sigma} = \mathbb{E}[(\mathbf{X} - \mathbb{E}[\mathbf{X}])(\mathbf{X} - \mathbb{E}[\mathbf{X}])^T]
$$
**具体形式**
$$
\boldsymbol{\Sigma} =
\begin{bmatrix}
\text{Var}(X_1) & \text{Cov}(X_1, X_2) & \cdots & \text{Cov}(X_1, X_d) \\\\
\text{Cov}(X_2, X_1) & \text{Var}(X_2) & \cdots & \text{Cov}(X_2, X_d) \\\\
\vdots & \vdots & \ddots & \vdots \\\\
\text{Cov}(X_d, X_1) & \text{Cov}(X_d, X_2) & \cdots & \text{Var}(X_d)
\end{bmatrix}
$$

- $\text{Var}(X_i)$：变量 $X_i$ 的方差，表示该维度上的波动大小。
- $\text{Cov}(X_i, X_j)$：变量 $X_i$ 和 $X_j$ 的协方差，表示它们之间的相关性。

**特性**

1. **对称性**：协方差矩阵是对称矩阵，即 $\text{Cov}(X_i, X_j) = \text{Cov}(X_j, X_i)$。
2. **非负定性**：协方差矩阵是半正定的，即对于任意非零向量 $\mathbf{v}$，有 $\mathbf{v}^T \boldsymbol{\Sigma} \mathbf{v} \geq 0$。
3. **对角线元素**：对角线上的元素是每个变量的方差。

**几何意义**

协方差矩阵 $\boldsymbol{\Sigma}$ 在多维空间中描述随机变量分布的形状和方向：
1. **方差**：对角线元素表示每个维度上的扩展程度（沿坐标轴的散布宽度）。
2. **相关性**：非对角线元素表示不同维度之间的相互关系。
3. **椭球形分布**：对于多维高斯分布，协方差矩阵决定分布在空间中的椭球形状：
   - 椭球的主轴方向由协方差矩阵的特征向量决定。
   - 椭球的主轴长度由协方差矩阵的特征值决定。

**计算示例**

假设有一组二维数据：
$$
\mathbf{X} = \begin{bmatrix}
x_1 & y_1 \\
x_2 & y_2 \\
\vdots & \vdots \\
x_n & y_n
\end{bmatrix}
$$

1. 计算每个维度的均值 $\bar{x}$ 和 $\bar{y}$。
2. 协方差矩阵为：
$$
\boldsymbol{\Sigma} = \frac{1}{n}
\begin{bmatrix}
\sum (x_i - \bar{x})^2 & \sum (x_i - \bar{x})(y_i - \bar{y}) \\
\sum (x_i - \bar{x})(y_i - \bar{y}) & \sum (y_i - \bar{y})^2
\end{bmatrix}
$$

### 投影与渲染

Gaussian Splatting 的核心渲染方法是将 3D 高斯点投影到 2D 图像平面上：

#### 视角投影

通过摄像机视图矩阵将 3D 空间中的高斯点投影到 2D 图像平面，同时考虑每个高斯点的大小、形状以及视角变化对其投影形状的影响。

#### 混合与合成

多个高斯点在投影平面上可能重叠。在渲染时，需要对所有投影点进行透明度混合和加权平均。具体实现上，使用以下公式计算像素值：
$$
C_{\text{pixel}} = \sum_i T_i \cdot C_i
$$
其中：

- $C_{\text{pixel}}$ 是像素最终颜色；
- $C_i$ 是每个高斯点的颜色；
- $T_i$ 是高斯点的透明度权重，由其密度和深度决定。

通过这种方法，可以高效生成复杂的视觉效果，包括模糊、透明度和光照效果。

### 优化高斯点分布

为了让高斯点更准确地表示场景，通常需要对高斯点的参数进行优化。优化过程通常涉及：

- **输入数据**：通过多视角图像（如 NeRF 的输入数据），初始化高斯点云。
- **优化目标**：最小化重建图像与真实图像之间的差异（如使用均方误差或感知损失）。
- **梯度更新**：使用优化算法（如 Adam 优化器）调整高斯点的参数，包括位置、形状、颜色等。

这种优化可以结合神经网络进行，也可以直接基于传统优化算法完成。