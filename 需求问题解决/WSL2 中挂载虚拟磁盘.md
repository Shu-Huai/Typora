# WSL2 中挂载虚拟磁盘

## 1. 创建一个虚拟磁盘

可以使用Windows磁盘管理工具或者 PowerShell 命令行创建虚拟磁盘文件。

### 通过图形化磁盘管理工具创建

在计算机管理→存储→磁盘管理→创建 VHD 中进行操作

<img src="http://public.file.lvshuhuai.cn/images\image-20241113191005123.png" alt="image-20241113191005123" style="zoom:50%;" />

<img src="http://public.file.lvshuhuai.cn/images\image-20241113191040308.png" alt="image-20241113191040308" style="zoom:50%;" />

#### VHD和VHDX的区别

VHDX 和 VHD 都是虚拟硬盘格式，用于存储虚拟机的数据，但它们之间有一些关键区别：

1. **存储容量**：
   - **VHD**：最大支持 2TB 的虚拟硬盘容量。
   - **VHDX**：支持更大的存储容量，最大可以达到 64TB。
2. **性能**：
   - **VHDX**：提供了更高的性能，尤其是在大型虚拟机和高负载情况下。VHDX 在扩展性、稳定性方面进行了改进，能够处理更多的磁盘操作并减少性能瓶颈。
   - **VHD**：相对来说在性能上不如 VHDX，尤其在存储压力较大时。
3. **数据损坏恢复**：
   - **VHDX**：采用了一些保护机制来防止数据损坏，例如日志记录，减少数据损坏的风险。
   - **VHD**：没有类似的保护机制，因此在一些情况下，如果磁盘损坏，数据可能更难恢复。
4. **电力故障恢复**：
   - **VHDX**：在遭遇电力中断或虚拟机突然关闭的情况下，VHDX 的恢复能力比 VHD 强。它有更强的日志保护功能，能够减少数据丢失。
   - **VHD**：相对不如 VHDX 在这方面强大。
5. **支持的操作系统**：
   - **VHD**：较老的格式，许多旧版本的虚拟化平台或操作系统可能仅支持 VHD 格式。
   - **VHDX**：较新格式，Windows Server 2012 及之后的版本开始引入对 VHDX 的支持。
6. **文件格式**：
   - **VHD**：是一个较旧的虚拟硬盘格式，采用固定大小或动态扩展的方式存储数据。
   - **VHDX**：是 VHD 的增强版，支持动态扩展和更高效的存储方式，采用了更先进的文件结构。

总结来说，VHDX 在容量、性能和数据保护方面都有较大优势。如果你正在使用较新的虚拟化平台或需要支持大容量虚拟硬盘，VHDX 是更好的选择。如果兼容性或其他因素要求使用 VHD，可能需要根据实际情况决定。

### 通过 PowerShell 挂载 VHDX 文件

1. 打开 PowerShell（以管理员身份运行）。

2. 使用 `Mount-VHD` 命令挂载虚拟磁盘文件：

   ```powershell
   Mount-VHD -Path "C:\path\to\your\disk.vhdx"
   ```

3. 通过 `Get-Disk` 查看已挂载的磁盘。你可以查找磁盘号，通常是最后挂载的磁盘。

   ```powershell
   Get-Disk
   ```

4. 确认虚拟磁盘已经挂载，并找到该磁盘的盘符。

## 2. 为虚拟磁盘分配盘符

右键创建好的磁盘，选择初始化磁盘。

<img src="http://public.file.lvshuhuai.cn/images\image-20241113193749612.png" alt="image-20241113193749612" style="zoom:50%;" />

右键未分配的磁盘空间，选择创建新分区

<img src="http://public.file.lvshuhuai.cn/images\image-20241113193827630.png" alt="image-20241113193827630" style="zoom:50%;" />

## 3. 在 WSL2 中访问挂载的磁盘

在 WSL2 中，Windows 挂载的驱动器会自动挂载到 `/mnt/` 目录下。例如，如果你在 Windows 中挂载了 `E:` 驱动器，它将在 WSL2 中通过 `/mnt/e/` 路径访问。

1. 打开 WSL2 终端。

2. 通过以下路径访问磁盘：

   ```bash
   cd /mnt/e
   ```

3. 现在，你就可以在 WSL2 中操作该磁盘的内容了。
